<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>Админка — выводы</title>
<style>
body{background:#111;color:#eee;font-family:Arial}
table{width:100%;border-collapse:collapse;margin-top:15px}
th,td{border-bottom:1px solid #333;padding:6px;font-size:13px}
button{padding:4px 8px;margin-right:4px}
.pending{color:#ffd36a}
.paid{color:#6aff9a}
.rejected{color:#ff6a6a}
</style>
</head>
<body>

<h2>Админка — выводы</h2>

<input id="token" placeholder="ADMIN_TOKEN">
<button onclick="load()">Обновить</button>

<table>
<thead>
<tr>
  <th>ID</th>
  <th>Адрес</th>
  <th>Куда</th>
  <th>TON</th>
  <th>Статус</th>
  <th>Действия</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<script>
async function api(url, body) {
  const token = document.getElementById('token').value.trim();
  const opt = body ? {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer ' + token
    },
    body: JSON.stringify(body)
  } : {
    headers: { 'Authorization': 'Bearer ' + token }
  };
  const r = await fetch(url, opt);
  return r.json();
}

async function load() {
  const j = await api('/api/admin/withdraw/list');
  const tb = document.getElementById('rows');
  tb.innerHTML = '';

  j.withdrawals.forEach(w => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${w.id}</td>
      <td>${w.address}</td>
      <td>${w.to_address}</td>
      <td>${(w.amount_nano / 1e9).toFixed(3)}</td>
      <td class="${w.status}">${w.status}</td>
      <td>
        ${w.status === 'pending'
          ? `<button onclick="approve('${w.id}')">Принять</button>
             <button onclick="rejectW('${w.id}')">Отклонить</button>`
          : '-'}
      </td>
    `;
    tb.appendChild(tr);
  });
}

async function approve(id) {
  await api('/api/admin/withdraw/approve', { id });
  load();
}

async function rejectW(id) {
  await api('/api/admin/withdraw/reject', { id });
  load();
}
</script>

</body>
</html>
